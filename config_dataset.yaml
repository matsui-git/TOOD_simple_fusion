# データセット設定 v2
dataset:
  # 画像サイズ
  img_width: 640
  img_height: 512
  
  # クラス設定
  num_classes: 3
  class_names: ['person', 'bicycle', 'car']

  # アノテーションのクラスIDオフセット
  # 0: アノテーションが0始まり (person=0, bicycle=1, car=2)
  # 1: アノテーションが1始まり (person=1, bicycle=2, car=3)
  class_id_offset: 1
  
  # データパス
  train:
    rgb_dir: '../../FLIR/images/train/rgb'
    ir_dir: '../../FLIR/images/train/thermal'
    label_dir: '../../FLIR/labels/train/rgb'
    max_samples: null
  
  validation:
    rgb_dir: '../../FLIR/images/val/rgb'
    ir_dir: '../../FLIR/images/val/thermal'
    label_dir: '../../FLIR/labels/val/rgb'
    max_samples: null

  
  # データローダー設定
  batch_size: 4
  num_workers: 0
  pin_memory: true
  
  # データ拡張設定（強化版）
  transform_prob: 0.5
  augmentation:
    flip_prob: 0.5            # 水平反転
    scale_range: [0.5, 1.5]   # 0.8-1.2 -> 0.5-1.5 (範囲拡大)
    scale_prob: 0.6           # 0.5 -> 0.6 (確率増加)
    rotate_range: [-20, 20]   # -10 -> -20 (回転範囲拡大)
    rotate_prob: 0.5          # 0.3 -> 0.5 (確率増加)
    translate_range: [-0.15, 0.15]  # -0.1 -> -0.15 (範囲拡大)
    translate_prob: 0.5       # 0.3 -> 0.5 (確率増加)
    # 色調整強化
    brightness_prob: 0.5      # 追加
    brightness_range: [0.7, 1.3]  # 追加
    contrast_prob: 0.5        # 追加
    contrast_range: [0.7, 1.3]    # 追加

# モデル設定
model:
  fusion_backbone: 'resnet34'
  yolo_cfg: 'yolov5l.yaml'
  pretrained_yolo: ./yolov5l.pt
  fusion_loss_weight: 1.0  # 0.5 -> 1.0 (融合を強化)
  detection_loss_weight: 1.0

# 訓練設定 v2
training:
  epochs: 200
  
  # 学習率設定（改善）
  learning_rate: 0.001       # ベース学習率
  fusion_lr: 0.0001          # Fusion Network用学習率
  detector_lr: 0.0001        # 検出器用学習率（事前学習済みなので低めに）
  min_lr: 0.00001            # 0.000001 -> 0.00001 (学習率が下がりすぎないように)
  
  # Warmup設定（新規）
  warmup_epochs: 5
  
  # Phase切り替え設定（新規）
  unfreeze_epoch: 20                    # 検出器をunfreezeするエポック
  freeze_fusion_after_unfreeze: false    # unfreeze後にFusionをfreezeするか
  
  # オプティマイザ
  optimizer: 'adamw'         # 'sgd', 'adam', 'adamw'
  weight_decay: 0.0001
  momentum: 0.937            # SGD用
  
  # Early Stopping設定（緩和版）
  early_stopping:
    patience: 40             # 15 -> 40 (改善がないエポック数)
    min_delta: 0.0001        # 0.001 -> 0.0001 (改善とみなす最小変化量)
  
  # 検証・保存間隔
  val_interval: 1
  save_interval: 1
  
  # Gradient累積
  accumulation_steps: 1

test:
  rgb_dir: '../FLIR/test/rgb'
  ir_dir: '../FLIR/test/thermal'
  label_dir: '../FLIR/test/labels/rgb'
  max_samples: null

# 推論設定
inference:
  confidence_threshold: 0.15  # 0.25 -> 0.15 (Recall向上)
  iou_threshold: 0.45
  max_detections: null

# その他
output_dir: './runs/TOOD_attention_model_v2'
seed: 42

# MMDetection設定
use_mmdet: true
mmdet_config: 'configs/tood_r50_fpn_1x_coco 1.py'
mmdet_checkpoint: 'configs/tood_r50_fpn_1x_coco_20211210_103425-20e20746.pth'

# クラスウェイト自動調整
auto_adjust_class_weight: true  # mAPが低いクラスのウェイトを自動調整
class_weight_update_interval: 10  # 10エポックごとに更新